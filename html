<!DOCTYPE html>
<html>
<head>
    <base target="_top">
    <meta name="viewport" content="width=device-width, initial-scale=1"> 
    <style>
        /* --- Branding & Color Palette Enhancement --- */
        :root {
            /* Deeper charcoal for primary text and elements */
            --primary-color: #1A202C; 
            /* Warmer, premium gold/yellow for highlights */
            --secondary-color: #F3C012; 
            --success-color: #2ECC71; /* Brighter, friendly green */
            --danger-color: #E74C3C; /* Clear red */
            --low-stock-bg: #fffbe6; /* Very light yellow for low stock cells */
            --low-stock-text: #E67E22; /* Orange text for warning */
            --card-bg: #FFFFFF;
            --body-bg: #f7f9fa; /* Slight off-white background */
        }

        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 0; 
            background-color: var(--body-bg); 
            color: var(--primary-color); 
        }
        
        .container { 
            max-width: 900px; 
            margin: 30px auto; /* Increased margin for breathing room */
            background: var(--card-bg); 
            padding: 25px 35px; /* More padding */
            border-radius: 12px; /* Softer corners */
            box-shadow: 0 10px 30px rgba(0,0,0,0.08); /* Stronger, softer shadow */
        }
        
        /* --- Logo Styling --- */
        .logo-container {
            text-align: center;
            margin-bottom: 20px; /* Reduced margin slightly to fit name */
            padding-bottom: 5px; 
            border-bottom: 1px solid #eee; 
        }

        .logo-container img {
            max-width: 180px; 
            height: auto;
            display: block; 
            margin: 0 auto 10px auto; /* Space below image before title */
        }
        
        /* --- App Title Styling --- */
        #app-title {
            color: var(--primary-color);
            text-align: center;
            margin: 0 0 20px 0; /* Space below the title before tabs start */
            font-size: 1.5em; /* Slightly larger than h3, smaller than h1 */
            font-weight: 600;
        }

        h2 { 
            border-bottom: 1px solid #eee; 
            padding-bottom: 10px; 
            margin-top: 5px;
            color: #34495e;
        }

        /* --- Tab Styling Enhancement --- */
        #tabs { 
            display: flex; 
            gap: 5px; 
            border-bottom: none; 
        }
        
        .tab-button { 
            background-color: #EAECEE; 
            border: none; 
            padding: 12px 20px; 
            cursor: pointer; 
            border-radius: 8px 8px 0 0; 
            font-weight: 600; 
            transition: all 0.2s ease-in-out; 
            color: var(--primary-color);
            flex-grow: 1;
            max-width: 33%;
        }
        
        .tab-button:hover { 
            background-color: #d8d8d8; 
        }
        
        /* Inverted look for active tab */
        .tab-button.active { 
            background-color: var(--card-bg); 
            color: var(--primary-color); 
            border-top: 3px solid var(--secondary-color); 
            border-left: 1px solid #eee;
            border-right: 1px solid #eee;
            transform: translateY(1px); 
            box-shadow: 0 -2px 5px rgba(0,0,0,0.05);
        }
        
        .tab-content { 
            border: 1px solid #eee; 
            padding: 30px; 
            border-radius: 0 8px 8px 8px; 
            margin-top: -1px; 
            background-color: var(--card-bg);
        }

        /* --- Form Input & Button Styling Enhancement --- */
        label { 
            display: block; 
            margin-top: 15px; 
            font-weight: 600; 
            color: #34495e;
            font-size: 0.95em;
        }
        
        input[type="number"], input[type="text"], select { 
            width: 100%; 
            padding: 12px; 
            margin-top: 8px; 
            margin-bottom: 20px; 
            box-sizing: border-box; 
            border: 1px solid #ddd; 
            border-radius: 6px; 
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        
        input:focus, select:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(243, 192, 18, 0.2); 
            outline: none;
        }

        button { 
            background-color: var(--primary-color); 
            color: white; 
            padding: 12px 20px; 
            border: none; 
            cursor: pointer; 
            border-radius: 6px; 
            font-weight: bold;
            transition: background-color 0.3s, transform 0.1s; 
            margin-top: 10px;
        }
        
        button:hover { 
            background-color: #34495e; 
            transform: translateY(-1px);
        }
        
        /* Secondary button style for less aggressive look (optional) */
        .secondary-button {
            background-color: var(--secondary-color);
            color: var(--primary-color);
        }
        .secondary-button:hover {
            background-color: #fbd455;
            color: var(--primary-color);
        }

        /* --- Table Styling Enhancement --- */
        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-top: 20px; 
            border-radius: 8px;
            overflow: hidden; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        th, td { 
            padding: 12px 15px; 
            text-align: left; 
            border: none; 
        }
        
        th { 
            background-color: var(--primary-color); 
            color: white; 
            font-weight: 600;
        }

        /* Zebra striping for readability */
        tr:nth-child(even) { 
            background-color: #fcfcfc; 
        }
        
        /* --- Status Indicators Refactor --- */
        .status-indicator { 
            font-weight: bold; 
            padding: 5px 10px; 
            border-radius: 20px; 
            display: inline-block; 
            font-size: 0.9em;
        }
        
        .status-indicator.good { 
            background-color: var(--success-color); 
            color: white; 
        }
        
        .status-indicator.low { 
            background-color: var(--low-stock-bg); 
            color: var(--low-stock-text); 
            border: 1px solid var(--low-stock-text);
        }
        
        .status-indicator.reorder { 
            background-color: var(--danger-color); 
            color: white; 
        }

        /* --- Alerts & Reports Enhancement --- */
        .alert { 
            padding: 15px; 
            color: white; 
            margin-bottom: 20px; 
            border-radius: 6px; 
            font-weight: bold;
            display: none; 
            animation: fadeIn 0.5s;
        }
        
        .alert.success { 
            background-color: var(--success-color); 
        }
        
        .alert.error { 
            background-color: var(--danger-color); 
        }
        
        .report-box { 
            padding: 18px; 
            margin-bottom: 15px; 
            border-radius: 8px; 
            font-size: 1.1em; 
            font-weight: 500;
            border-left: 5px solid;
        }
        
        .report-box strong {
            font-size: 1.2em;
            font-weight: 700;
        }

        .report-box.revenue { 
            background-color: #EAF2F8; 
            color: var(--primary-color); 
            border-left-color: #3498DB;
        }
        
        .report-box.expense { 
            background-color: #FCF3CF; 
            color: var(--primary-color); 
            border-left-color: var(--secondary-color);
        }

        .report-box.net-profit {
            font-weight: bold;
            border-left-color: var(--success-color);
        }
        
        .report-box.net-profit.profit { 
            background-color: #E8F8F5; /* Light green */
            border: 1px solid var(--success-color);
        }
        
        .report-box.net-profit.loss { 
            background-color: #FADBD8; /* Light red */
            border: 1px solid var(--danger-color);
            border-left-color: var(--danger-color);
        }

    </style>
</head>
<body>
    <div class="container">
        
        <div class="logo-container">
            <img src="https://drive.google.com/uc?id=1EsTclAtvSwViLRVt9_wPnWP4milBtXOS" alt="Respresso Logo">
        </div>
        
        <h3 id="app-title">Respresso Inventory Manager</h3>

        <div id="tabs">
            <button class="tab-button active" onclick="openTab('inventory')">ðŸ“¦ Inventory Stock</button>
            <button class="tab-button" onclick="openTab('transfer')">ðŸšš Transfer Items</button>
            <button class="tab-button" onclick="openTab('finance')">ðŸ’° Financial Review</button>
        </div>

        <div id="inventory" class="tab-content">
            <h2>Current Inventory Stock</h2>
            <div id="inventory-table-container"></div>
            
            <hr style="margin: 30px 0; border: 0; border-top: 1px solid #eee;">
            
            <h3>âž• Record New Stock Arrival</h3>
            <div class="alert error" id="add-stock-status"></div>
            
            <label for="addItemSelect">Select Item:</label>
            <select id="addItemSelect"></select>
            
            <label for="addQuantity">Quantity to Add:</label>
            <input type="number" id="addQuantity" min="1" placeholder="Enter quantity received">
            
            <button onclick="submitAddStock()">Record Stock Addition</button>
        </div>

        <div id="transfer" class="tab-content" style="display: none;">
            <h2>Record Item Transfer to Cafe</h2>
            <div class="alert error" id="transfer-status"></div>
            
            <label for="itemSelect">Select Item:</label>
            <select id="itemSelect"></select>
            
            <label for="transferQuantity">Quantity to Transfer:</label>
            <input type="number" id="transferQuantity" min="1" placeholder="Enter quantity transferred">
            
            <button onclick="submitTransfer()">Record Transfer</button>
        </div>

        <div id="finance" class="tab-content" style="display: none;">
            <h2>Financial Summary (All-Time)</h2>
            <div id="summary-section">
            </div>
            
            <hr style="margin: 30px 0; border: 0; border-top: 1px solid #eee;">

            <h3>Record New Financial Entry</h3>
            <div class="alert error" id="finance-status"></div>
            
            <label for="financeType">Entry Type:</label>
            <select id="financeType">
                <option value="Revenue">Revenue</option>
                <option value="Expense">Expense</option>
            </select>
            
            <label for="financeDescription">Description:</label>
            <input type="text" id="financeDescription" placeholder="e.g., Coffee Bean Shipment, POS Sales">
            
            <label for="financeValue">Value (EGP):</label>
            <input type="number" id="financeValue" min="0.01" step="0.01" placeholder="0.00">
            
            <button onclick="submitFinance()">Record Entry</button>
        </div>
    </div>

    <script>
        // --- General Functions (Unchanged) ---
        function openTab(tabName) {
            const contents = document.getElementsByClassName('tab-content');
            for (let i = 0; i < contents.length; i++) {
                contents[i].style.display = 'none';
            }
            document.getElementById(tabName).style.display = 'block';

            const buttons = document.getElementsByClassName('tab-button');
            for (let i = 0; i < buttons.length; i++) {
                buttons[i].classList.remove('active');
            }
            const clickedButton = event ? event.currentTarget : document.querySelector(`.tab-button[onclick*="'${tabName}'"]`);
            if (clickedButton) {
                clickedButton.classList.add('active');
            }

            if (tabName === 'inventory') {
                loadInventory();
            } else if (tabName === 'finance') {
                loadFinanceSummary();
            } else if (tabName === 'transfer') {
                loadTransferItems(); 
            }
        }
        
        function showAlert(id, message, isSuccess) {
            const alertBox = document.getElementById(id);
            alertBox.textContent = message;
            alertBox.className = 'alert ' + (isSuccess ? 'success' : 'error');
            alertBox.style.display = 'block';
            setTimeout(() => {
                alertBox.style.display = 'none';
            }, 5000);
        }
        
        function populateItemDropdowns(inventoryData) {
            const selectTransfer = document.getElementById('itemSelect');
            const selectAdd = document.getElementById('addItemSelect');

            selectTransfer.innerHTML = '';
            selectAdd.innerHTML = '';

            inventoryData.forEach(item => {
                const optionTransfer = document.createElement('option');
                optionTransfer.value = item.name;
                // Enhanced text to show available stock in transfer dropdown
                optionTransfer.textContent = `${item.name} (${item.stock} ${item.unit} available)`;
                selectTransfer.appendChild(optionTransfer);
                
                const optionAdd = document.createElement('option');
                optionAdd.value = item.name;
                optionAdd.textContent = item.name;
                selectAdd.appendChild(optionAdd);
            });
        }


        // ----------------- Inventory Management (Mock data uses loadInventory) -----------------

        function loadInventory() {
            // Note: Replace with your actual google.script.run call
            if (typeof google !== 'undefined' && google.script && google.script.run) {
                google.script.run.withSuccessHandler(dataString => {
                    const inventoryData = JSON.parse(dataString);
                    displayInventory(inventoryData);
                    populateItemDropdowns(inventoryData);
                }).getInventoryData();
            } else {
                // Mock data for pure HTML/CSS demo 
                const mockData = [
                    { name: "Coffee Beans (Kg)", unit: "Kg", stock: 150, reorderPoint: 50 },
                    { name: "Milk (Ltr)", unit: "Ltr", stock: 25, reorderPoint: 30 },
                    { name: "Sugar Sachets", unit: "Pcs", stock: 500, reorderPoint: 1000 },
                    { name: "Paper Cups (8oz)", unit: "Sleeve", stock: 80, reorderPoint: 75 }
                ];
                displayInventory(mockData);
                populateItemDropdowns(mockData);
            }
        }

        function displayInventory(inventoryData) {
            const container = document.getElementById('inventory-table-container');
            let html = '<table><thead><tr><th>Item Name</th><th>Unit</th><th>Current Stock</th><th>Reorder Point</th><th>Status</th></tr></thead><tbody>';
            
            inventoryData.forEach(item => {
                let status = '';
                let statusClass = '';

                if (item.stock <= item.reorderPoint) {
                    status = 'ðŸš¨ Reorder Now!';
                    statusClass = 'reorder';
                } else if (item.stock <= item.reorderPoint * 1.5) { // Adjusted multiplier for 'Low Stock'
                    status = 'âš ï¸ Low Stock';
                    statusClass = 'low';
                } else {
                    status = 'âœ… Good';
                    statusClass = 'good';
                }
                
                html += `<tr>
                            <td>${item.name}</td>
                            <td>${item.unit}</td>
                            <td>${item.stock}</td>
                            <td>${item.reorderPoint}</td>
                            <td><span class="status-indicator ${statusClass}">${status}</span></td>
                        </tr>`;
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // --- Stock & Transfer Logic (Unchanged) ---
        function submitAddStock() {
            const itemName = document.getElementById('addItemSelect').value;
            const quantity = parseFloat(document.getElementById('addQuantity').value);
            
            if (!itemName || isNaN(quantity) || quantity <= 0) {
                showAlert('add-stock-status', 'Please enter a valid item and quantity greater than 0.', false);
                return;
            }

            const confirmationMessage = `Are you sure you want to add ${quantity} units of ${itemName} to stock?`;
            
            if (confirm(confirmationMessage)) {
                // Call Apps Script function (mocked here)
                if (typeof google !== 'undefined' && google.script && google.script.run) {
                    google.script.run.withSuccessHandler(handleAddStockResponse).addStock(itemName, quantity);
                } else {
                    handleAddStockResponse({ success: true, message: `MOCK: Added ${quantity} of ${itemName} successfully!` });
                }
            } else {
                showAlert('add-stock-status', 'Stock addition cancelled by user.', false);
            }
        }

        function handleAddStockResponse(response) {
            if (response.success) {
                showAlert('add-stock-status', response.message, true);
                document.getElementById('addQuantity').value = ''; 
                loadInventory();
            } else {
                showAlert('add-stock-status', response.message, false);
            }
        }

        function loadTransferItems() {
            // Re-runs loadInventory, which calls populateItemDropdowns
            loadInventory(); 
        }

        function submitTransfer() {
            const itemName = document.getElementById('itemSelect').value;
            const quantity = parseFloat(document.getElementById('transferQuantity').value);
            
            if (!itemName || isNaN(quantity) || quantity <= 0) {
                showAlert('transfer-status', 'Please enter a valid item and quantity.', false);
                return;
            }

            // Call Apps Script function (mocked here)
            if (typeof google !== 'undefined' && google.script && google.script.run) {
                google.script.run.withSuccessHandler(handleTransferResponse).recordTransfer(itemName, quantity);
            } else {
                handleTransferResponse({ success: true, message: `MOCK: Transferred ${quantity} of ${itemName} successfully!` });
            }
        }

        function handleTransferResponse(response) {
            if (response.success) {
                showAlert('transfer-status', response.message, true);
                document.getElementById('transferQuantity').value = ''; 
                loadInventory(); 
            } else {
                showAlert('transfer-status', response.message, false);
            }
        }

        // ----------------- Finances (Currency is EGP) -----------------

        function loadFinanceSummary() {
            // Call Apps Script function (mocked here)
            if (typeof google !== 'undefined' && google.script && google.script.run) {
                google.script.run.withSuccessHandler(displayFinanceSummary).getFinanceSummary();
            } else {
                // Mock data in EGP
                const mockSummary = { revenue: 152500.75, expenses: 84300.50, netProfit: 68200.25 };
                displayFinanceSummary(mockSummary);
            }
        }
        
        function displayFinanceSummary(summary) {
            const container = document.getElementById('summary-section');
            const netProfit = summary.netProfit;
            const profitClass = netProfit >= 0 ? 'profit' : 'loss';
            const profitSign = netProfit >= 0 ? '' : '-';
            
            container.innerHTML = `
                <div class="report-box revenue">
                    ðŸ’¸ Total Revenue: <strong>EGP ${summary.revenue.toFixed(2)}</strong>
                </div>
                <div class="report-box expense">
                    ðŸ§¾ Total Expenses: <strong>EGP ${summary.expenses.toFixed(2)}</strong>
                </div>
                <div class="report-box net-profit ${profitClass}">
                    ðŸ“Š Net Profit: <span style="color: var(--${profitClass === 'profit' ? 'success' : 'danger'}-color);">
                        <strong>${profitSign}EGP ${Math.abs(netProfit).toFixed(2)}</strong>
                    </span>
                </div>
            `;
        }

        function submitFinance() {
            const type = document.getElementById('financeType').value;
            const description = document.getElementById('financeDescription').value;
            const value = parseFloat(document.getElementById('financeValue').value);
            
            if (!description || isNaN(value) || value <= 0) {
                showAlert('finance-status', 'Please enter a valid description and value.', false);
                return;
            }

            // Call Apps Script function (mocked here)
            if (typeof google !== 'undefined' && google.script && google.script.run) {
                google.script.run.withSuccessHandler(handleFinanceResponse).recordFinance(type, description, value);
            } else {
                handleFinanceResponse({ success: true, message: `MOCK: Recorded ${type} of EGP ${value.toFixed(2)}.` });
            }
        }

        function handleFinanceResponse(response) {
            if (response.success) {
                showAlert('finance-status', response.message, true);
                document.getElementById('financeDescription').value = '';
                document.getElementById('financeValue').value = '';
                loadFinanceSummary(); 
            } else {
                showAlert('finance-status', 'An error occurred during recording.', false);
            }
        }


        // Initial Load
        document.addEventListener('DOMContentLoaded', () => {
            openTab('inventory');
        });
    </script>
</body>
</html>
